<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mily Alfajor - Pedido</title>
  
</head>
<body>
  <header>
    Mily Alfajor
  </header>

  <main>
    <div id="closedNotice"></div>

    <ul id="productList"></ul>

    <h2>Resumo do Pedido</h2>
    <ul id="resumoPedido"></ul>

    <h2>Dados do Cliente</h2>
    <label>Nome:<br><input type="text" id="nome"></label><br><br>
    <label>Telefone:<br><input type="text" id="telefone"></label><br><br>
    <label>EndereÃ§o:<br><input type="text" id="endereco"></label><br><br>

    <h3>Forma de Pagamento</h3>
    <label><input type="radio" name="pagamento" value="Dinheiro" checked> Dinheiro</label><br>
    <label><input type="radio" name="pagamento" value="Pix"> Pix</label><br>
    <label><input type="radio" name="pagamento" value="CartÃ£o"> CartÃ£o</label><br><br>

    <label>ObservaÃ§Ãµes:<br><textarea id="observacoes"></textarea></label>
  </main>

<script>
// ===== CONFIGURAÃ‡Ã•ES =====
const horaAbertura = 9;
const horaFechamento = 3;
const whatsappNumber = '5524992438194';

// ===== ESTOQUE =====
const estoque = {
  'Brigadeiro': null,
  'Beijinho': null,
  'Doce de Leite': 0,
  'Creme de AvelÃ£': null,
  'Pistache': null,
  'Oreo': 0,
  'Kit Kat': 0
};

// ===== PRODUTOS =====
const produtos = [
  { id: 'Brigadeiro', name: 'Brigadeiro', price: 8.00, desc: 'Delicioso brigadeiro cremoso', img: 'fotos/BRIGADEIRO.png' },
  { id: 'Beijinho', name: 'Beijinho', price: 8.00, desc: 'Tradicional beijinho com coco', img: 'fotos/BEIJINHO.png' },
  { id: 'Doce de Leite', name: 'Doce de Leite', price: 8.00, desc: 'Doce de leite caseiro', img: 'fotos/DOCE DE LEITE 2.png' },
  { id: 'Creme de AvelÃ£', name: 'Creme de AvelÃ£', price: 9.00, desc: 'Creme de avelÃ£ premium', img: 'fotos/DOCE DE LEITE 1.png' },
  { id: 'Pistache', name: 'Pistache', price: 9.00, desc: 'Pistache com toque especial', img: 'fotos/PISTACHE.png' },
  { id: 'Oreo', name: 'Oreo', price: 0.00, desc: 'Oreo recheado', img: 'LOGOMARCA.png' },
  { id: 'Kit Kat', name: 'Kit Kat', price: 0.00, desc: 'Kit Kat crocante', img: 'LOGOMARCA.png' }
];

// ===== CUPONS =====
const cupons = { 'CUPOM10': 10 };

// ===== UTILITÃRIOS =====
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const formatCurrency = v => v.toFixed(2).replace('.', ',');
const pad = n => String(n).padStart(2, '0');

// ===== ESTADO =====
const state = { quantities: {}, appliedCoupon: null, discountPercent: 0 };

// ===== FUNÃ‡Ã•ES =====
function isLojaAberta() {
  const agora = new Date();
  const hora = agora.getHours();
  return (horaAbertura <= horaFechamento)
    ? (hora >= horaAbertura && hora < horaFechamento)
    : (hora >= horaAbertura || hora < horaFechamento);
}

function checkOpenStatus() {
  const open = isLojaAberta();
  const closedNotice = $('#closedNotice');
  if (!open) {
    closedNotice.style.display = 'block';
    closedNotice.textContent = `â›” Estamos fechados. HorÃ¡rio: ${pad(horaAbertura)}h Ã s ${pad(horaFechamento)}h`;
    $$('.btn-enviar').forEach(btn => btn.style.display = 'none');
  } else {
    closedNotice.style.display = 'none';
    $$('.btn-enviar').forEach(btn => btn.style.display = 'inline-block');
  }
}

function renderProducts(list) {
  const el = $('#productList');
  el.innerHTML = '';
  list.forEach(prod => {
    const li = document.createElement('li');
    li.className = 'product-item';
    li.innerHTML = `
      <img class="product-thumb" src="${prod.img}" alt="${prod.name}" />
      <div class="product-info">
        <div class="product-name">${prod.name}</div>
        <div>${prod.desc}</div>
      </div>
      <div class="product-controls">
        <div class="product-price">R$ ${formatCurrency(prod.price)}</div>
        <input type="number" min="0" value="0" class="product-quantity" data-id="${prod.id}" data-price="${prod.price}" />
      </div>
    `;
    el.appendChild(li);
  });
  attachQuantityListeners();
}

function attachQuantityListeners(){
  $$('.product-quantity').forEach(inp => {
    inp.addEventListener('input', onQtyChange);
    inp.addEventListener('change', onQtyChange);
  });
}

function onQtyChange(e){
  const inp = e.target;
  const id = inp.dataset.id;
  let q = parseInt(inp.value) || 0;
  const s = estoque[id];
  if (s !== null && q > s){
    q = s;
    inp.value = q;
    alert(`SÃ³ temos ${s} unidade(s) de ${id}.`);
  }
  state.quantities[id] = q;
  atualizarResumoPedido();
}

function atualizarResumoPedido() {
  let resumo = '';
  let total = 0;
  produtos.forEach(p => {
    const q = state.quantities[p.id] || 0;
    if (q > 0) {
      const sub = q * p.price;
      total += sub;
      resumo += `<li>${p.name} â€” ${q} un. â€” R$ ${formatCurrency(sub)}</li>`;
    }
  });
  const discount = state.discountPercent || 0;
  const discountValue = total * (discount / 100);
  const finalTotal = total - discountValue;
  resumo += `<li><strong>Total: R$ ${formatCurrency(finalTotal)}</strong></li>`;

  if (isLojaAberta()) {
    resumo += `<button class="btn-enviar" onclick="enviarPedido()">ðŸ“² Enviar Pedido</button>`;
  } else {
    resumo += `<p class="fechado">â›” Estamos fechados no momento. HorÃ¡rio: ${horaAbertura}h Ã s ${horaFechamento}h</p>`;
  }
  $('#resumoPedido').innerHTML = resumo;
  checkOpenStatus();
}

function enviarPedido(){
  const nome = $('#nome').value.trim();
  const telefone = $('#telefone').value.trim();
  const endereco = $('#endereco').value.trim();
  const pagamento = document.querySelector('input[name="pagamento"]:checked')?.value || '';
  const observacoes = $('#observacoes').value.trim();

  let message = `*ðŸ“¦ NOVO PEDIDO - MILY ALFAJOR*\n`;
  message += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
  message += `*ðŸ‘¤ Cliente:* ${nome}\n`;
  message += `*ðŸ“ž Telefone:* ${telefone}\n`;
  message += `*ðŸ“ EndereÃ§o:* ${endereco}\n`;
  message += `*ðŸ’³ Pagamento:* ${pagamento}\n`;
  if (observacoes) message += `*ðŸ“ ObservaÃ§Ãµes:* ${observacoes}\n`;

  message += `\n*ðŸ›’ ITENS DO PEDIDO:*\n`;
  message += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;

  let total = 0;
  produtos.forEach(p => {
    const q = state.quantities[p.id] || 0;
    if (q > 0){
      const sub = q * p.price;
      total += sub;
      message += `â€¢ ${p.name} â€” ${q} un. â€” R$ ${formatCurrency(sub)}\n`;
    }
  });

  const discount = state.discountPercent || 0;
  const discountValue = total * (discount/100);
  const finalTotal = total - discountValue;

  message += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
  message += `*ðŸ’° TOTAL:* R$ ${formatCurrency(finalTotal)}\n`;
  if (state.appliedCoupon) {
    message += `*ðŸ· CUPOM:* ${state.appliedCoupon} (${discount}%)\n`;
  }
  message += `\nâœ… *Obrigado por comprar com a Mily Alfajor!*`;

  const encoded = encodeURIComponent(message);
  const url = `https://wa.me/${whatsappNumber}?text=${encoded}`;
  window.open(url, '_blank');
}

document.addEventListener('DOMContentLoaded', function() {
  renderProducts(produtos);
  produtos.forEach(p => state.quantities[p.id] = 0);
  atualizarResumoPedido();
});
</script>
</body>
</html>

